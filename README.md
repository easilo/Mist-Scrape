# Mist Scrape
**Author:** Erin Asilo \
**Title:** Infrastructure Network Intern \
**Organization:** RingCentral \
**Purpose:** To automate the process of grabbing certain requested metrics from Mist and put into Google sheets using the sheets API. Currently it grabs the data for client counts of each site daily, as well as successful connect percentage every Friday. 

*Note: This code will not work as is since some files are omitted to protect the privacy of API keys and login credentials. Please see requirements in the next section to get it up and running.*

# Requirements
In order to run this code a project on cloud.google.com must be created along with a service account and service account credentials. \
Then a *.env* file containing the following is required and must be in *run_files* directory.

## .env file
Rename ".template.env" to ".env and fill in the following details

```python
EMAIL = 'mistlogin@example.com'

PASSWORD = 'examplepass'

DOWNLOAD_PATH = 'C:\\Users\\Path to run_files directory'

ZIP_PATH = 'C:\\Users\\Path to run_files\<Mist Analytics Zipfile>.zip'

SPREADSHEET_ID = 'ID of target Google Sheet'

SERVICE_ACCOUNT = 'C:\\Users\Path to service account .json'
```
## Google Service Account
The service account is required to use Google APIs without using a user account. The service account can be generated by creating a project on cloud.google.com. Then go to the Google Cloud console, also on cloud.google.com, then on the left sidebar go to "IAM & Admin" -> "Service Accounts". Create a new service account here and download the credentials as a *.json* file. Place that file into the *run_files* folder.

# Running the script
The code can be ran manually by using *Mist_Scrape.bat* when **all the prerequisites are met.**

*Note: Mist_Scrape.bat might need to be edited to reflect the correct file path for main.py*

## Automate script running daily with Windows Task Scheduler
To automate the running of this program every day, I use Windows Task Scheduler.

*Note: If using task scheduler to run this daily, the task must be set to only run while logged in. This is because chrome headless mode does not work for manage.mist.com*

*Note: If running on a pc instead of a server, the pc must not have the user log out and must stay on and connected to a network. You will need to modify your windows settings to do so. Not sure if the same is required for server running since I've only tested with a laptop.*

### Windows Task Scheduler Instructions for daily automation
```
- Create new basic task
- General
  - Run only when user is logged in
  - Run with highest priveleges
- Triggers
  - Start task on a schedule
  - Daily at 5:00pm (PST) everyday
  - Delay task for up to 1 minute
  - Stop task if it runs longer than 1 hour
- Actions
  - Start a program
  - Program/Script: Mist_Scrape.bat
  - Start in: C:\<Path to repo>\Mist-Scrape\
- Conditions
  - ONLY wake computer to start task
  - AND Start when any network connection is available
- Settings
  - Allow task to be run on demand (for testing)
  - Stop task if it runs longer than 1 hour
  - If running task does not end when requested, force to stop
  - If task is already running, stop the existing instance
```
